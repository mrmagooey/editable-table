var tabooTable=function(e,t,n){function o(e){w(),u.taboo.getColumnHeaders().forEach(function(e){h(e)}),u.taboo.getRows({objects:!1}).forEach(function(e){p({data:e})})}function r(){t.clear({silent:!0});for(var e=c.querySelector("thead tr").children,n=0;n<e.length;n++)t.addColumns([e[n].querySelector("span").textContent],{silent:!0});var o=c.querySelectorAll("tbody tr");for(n=0;n<o.length;n++){for(var r=o[n],a=[],d=0;d<r.children.length;d++)a.push(r.children[d].querySelector("span").textContent);t.addRow(a,{silent:!0})}t.triggerCallbacks("update")}function a(){t.registerCallback("update",o)}function d(e,t){var n=window.getComputedStyle(t);s.forEach(function(t){e.style[t]=n[t]})}var i={addRowsButtons:!0,addRowHeaderButtons:!0,editableRows:!0,editableRowHeader:!0,autocomplete:!0},l={};_.isObject(n)?_.extend(l,i,n):l=i;var c=document.querySelector(e),u=this,s=["padding","padding-top","padding-bottom","padding-left","padding-right","text-align","font","font-size","font-family","font-weight","border","border-top","border-bottom","border-left","border-right","height","width"];if(this.taboo=t,null===c)return void console.log("Taboo-Table Selector "+e+" does not exist");this.updateTaboo=function(e){this.taboo=e,o()};var p=this.addRow=function(e){var t,n;"undefined"==typeof e&&(e={}),e.hasOwnProperty("index")&&(t=e.index),e.hasOwnProperty("data")&&(n=e.data);var o,r=c.querySelector("tbody tr"),a=c.querySelector("tbody td"),i=c.querySelector("tbody");if(t+=1){var u=i.querySelector("tr:nth-of-type("+t+")");o=null===typeof u?i.appendChild(document.createElement("tr")):i.insertBefore(document.createElement("tr"),u)}else o=i.appendChild(document.createElement("tr")),r&&d(o,r);for(var s,p,h=c.querySelector("thead tr").children,f=0;f<h.length;f++)s=document.createElement("td"),p=document.createElement("span"),s.appendChild(p),a&&d(s,a),n?p.textContent=n[f]:p.textContent="",l.editableRows&&(s.tabIndex="1"),o.appendChild(s);return l.addRowsButtons&&E(o),o},h=this.addColumn=function(e,t,n){"undefined"==typeof e&&(e="empty"),"undefined"==typeof t&&(t=[]);var o;if("number"==typeof n){n+=1;var r=c.querySelector("thead tr :nth-of-type("+n+")");o=null===r?c.querySelector("thead tr").appendChild(document.createElement("th")):c.querySelector("thead tr").insertBefore(document.createElement("th"),r)}else o=c.querySelector("thead tr").appendChild(document.createElement("th"));var a=o.appendChild(document.createElement("span")),d=c.querySelectorAll("tbody tr");a.textContent=e;for(var i=0;i<d.length;i++){var u,s=d[i];u="undefined"==t[i]?"":t[i];var p=document.createElement("td"),h=document.createElement("span");if(p.appendChild(h),"number"==typeof n){var f=s.querySelector(":nth-of-type("+n+")");s.insertBefore(p,f)}else s.appendChild(p);l.editable&&(p.tabIndex="1"),h.textContent=u}l.addRowHeaderButtons&&N(o)},f=this.deleteColumn=function(e){var t=c.querySelector("thead tr th:nth-of-type("+(e+1)+")"),n=c.querySelector("thead tr");n.removeChild(t);for(var o=c.querySelectorAll("tbody tr"),r=0;r<o.length;r++){var a=o[r],d=a.querySelector(":nth-of-type("+(e+1)+")");a.removeChild(d)}},v=(this.deleteRow=function(e){var t=c.querySelector("tbody tr:nth-of-type("+e+")"),n=c.querySelector("tbody");n.removeChild(t)},document.createEvent("Event"));v.initEvent("kill",!0,!0);var y=document.createEvent("Event");y.initEvent("stopKill",!0,!0);var m=function(e){var t;if("SPAN"===e.target.tagName)t=e.target.parentNode;else{if("TD"!==e.target.tagName)return void 0;t=e.target}var n=t.parentNode,o=(n.parentNode,n.lastChild),a=o.querySelector(".buttonWrapper");if(a)return a.dispatchEvent(y),a;var d=n.getBoundingClientRect(),i=document.createElement("div"),l=document.createElement("div"),c=document.createElement("p"),u=document.createElement("p"),s=20;i.className="buttonWrapper",i.appendChild(l),l.className="buttonsDiv",l.appendChild(c),l.appendChild(u),l.style.top=d.top+document.body.scrollTop+5+"px",l.style.left=d.right+document.body.scrollLeft-s-40+"px",c.textContent="+",u.textContent="—",c.className="plus",u.className="minus";var h=function(e){e.stopPropagation();var t=e.target,n=t.parentNode,o=n.parentNode,a=o.parentNode,d=a.parentNode,i=d.parentNode,l=Array.prototype.indexOf.call(i.childNodes,d);p({index:l}),r()},f=function(e){e.stopPropagation();var t=e.target,n=t.parentNode,o=n.parentNode,a=o.parentNode,d=a.parentNode,i=d.parentNode;Array.prototype.indexOf.call(i.childNodes,d);i.removeChild(d),r()};c.addEventListener("click",h),c.addEventListener("dblclick",h),u.addEventListener("click",f),u.addEventListener("dblclick",f);var m,g=!1;return i.addEventListener("kill",function(){g||(g=!0,m=window.setTimeout(function(){o.removeChild(i)},50))}),i.addEventListener("stopKill",function(){g=!1,window.clearTimeout(m)}),i.addEventListener("mouseover",function(){i.dispatchEvent(y)}),i.addEventListener("mouseout",function(){i.dispatchEvent(v)}),o.appendChild(i),i},g=function(e){var t=e.target,n=t.parentNode,o=n.lastChild,r=o.querySelector(".buttonWrapper");r&&r.dispatchEvent(v)},E=function(e){e.addEventListener("mouseover",m),e.addEventListener("mouseout",g),e.addEventListener("click",g)},b=function(e){var t;if("TH"===e.target.tagName)t=e.target;else{if("SPAN"!==e.target.tagName)return void 0;t=e.target.parentNode}var n=t.parentNode;n.parentNode;if("TH"!==t.nodeName)return void 0;var o=t.querySelector(".buttonsDiv");if(o)return o.dispatchEvent(y),o;var a=t.getBoundingClientRect(),d=document.createElement("div"),i=document.createElement("p"),l=document.createElement("p"),c=20;d.className="buttonsDiv",d.appendChild(i),d.appendChild(l),d.style.top=a.top+document.body.scrollTop+5+"px",d.style.left=a.right+document.body.scrollLeft-c-40+"px",i.textContent="+",l.textContent="—",i.className="plus",l.className="minus";var u=function(e){e.stopPropagation();var t=e.target,n=t.parentNode,o=n.parentNode,a=o.parentNode,d=Array.prototype.indexOf.call(a.childNodes,o);h("New Column",void 0,d),r()},s=function(e){e.stopPropagation();var t=e.target,n=t.parentNode,o=n.parentNode,a=o.parentNode,d=Array.prototype.indexOf.call(a.childNodes,o);f(d),r()};i.addEventListener("click",u),i.addEventListener("dblclick",u),l.addEventListener("click",s),l.addEventListener("dblclick",s);var p,m=!1;return d.addEventListener("kill",function(){m||(m=!0,p=window.setTimeout(function(){t.removeChild(d)},50))}),d.addEventListener("stopKill",function(){m=!1,window.clearTimeout(p)}),d.addEventListener("mouseover",function(){d.dispatchEvent(y)}),d.addEventListener("mouseout",function(){d.dispatchEvent(v)}),t.appendChild(d),d},C=function(e){var t=e.target,n=(t.parentNode,t.querySelector(".buttonsDiv"));n&&n.dispatchEvent(v)},N=function(e){e.addEventListener("mouseover",b),e.addEventListener("mouseout",C),e.addEventListener("click",C)},w=function(){c.innerHTML="<thead><tr></tr></thead><tbody></tbody>"},S=function(e){var t,n={cloneProperties:["padding","padding-top","padding-bottom","padding-left","padding-right","text-align","font","font-size","font-family","font-weight","border","border-top","border-bottom","border-left","border-right","height","width"]},o=c,a=document.querySelector("body").appendChild(document.createElement("input")),d=_.extend({},n,e),i=37,u=38,s=39,h=40,f=13,v=27,y=9,m=8;a.style.position="absolute",a.style.display="none",o.style.cursor="pointer";var g=function(e){if(t=e.target,t!==o&&t){if("SPAN"===t.tagName&&(t=t.parentNode),"TBODY"===t.parentNode.parentNode.tagName&&!l.editableRows||"THEAD"===t.parentNode.parentNode.tagName&&!l.editableRowHeader)return;a.value=t.querySelector("span").textContent;var n=window.getComputedStyle(t);d.cloneProperties.forEach(function(e){a.style[e]=n[e]}),a.classList.remove("error"),a.style.display="";var r=t.getBoundingClientRect();a.style.top=r.top+document.body.scrollTop+"px",a.style.left=r.left+document.body.scrollLeft+"px",a.focus()}},E=function(){var e=a.value;return t.querySelector("span").textContent===e||a.classList.contains("error")?!0:(t.querySelector("span").textContent=a.value,void r())},b=function(e,t){var n;if(t===s)return e.nextElementSibling;if(t===i)return e.previousElementSibling;if(t===u){n=Array.prototype.indexOf.call(e.parentNode.children,e);var o=e.parentNode.previousElementSibling;return o?o.children[n]:!1}if(t===h||t===f){n=Array.prototype.indexOf.call(e.parentNode.children,e);var r=e.parentNode.nextElementSibling;return r?r.children[n]:(r=p(),r.children[n])}return!1},C=function(e){E(),a.style.display="none"},N=function(e){var n,r,d=a.selectionEnd===a.value.length,l=0===a.selectionEnd,c=Array.prototype.indexOf.call(t.parentNode.children,t),p=Array.prototype.indexOf.call(t.parentNode.parentNode.children,t.parentNode);if(e.which===f){a.dispatchEvent(new Event("blur")),e.preventDefault(),e.stopPropagation(),n=o.querySelector("tr:nth-child("+(p+1)+") td:nth-child("+(c+1)+")");var m=b(n,f);m.focus()}else e.which===v?(a.value=t.querySelector("span").textContent,e.preventDefault(),e.stopPropagation(),a.style.display="none",t.focus()):e.which===y?(E(),a.style.display="none",n=o.querySelector("tr:nth-child("+(p+1)+") td:nth-child("+(c+1)+")"),r=b(n,s),r?r.focus():n.focus(),e.preventDefault(),e.stopPropagation()):d&&(e.which===h||e.which===s)||l&&(e.which===u||e.which===i)?(r=b(t,e.which),r&&(r.focus(),e.preventDefault(),e.stopPropagation())):w(e,c,p)},w=function(e,t,n){if(l.autocomplete){var r=a.selectionStart,d=e.shiftKey?String.fromCharCode(e.which):String.fromCharCode(e.which).toLowerCase(),i=window.getSelection().toString(),c=function(){var e=o.querySelectorAll("tr td:nth-child("+(t+1)+") span"),r=[];return Array.prototype.forEach.call(e,function(e,t){t!==n&&(e.textContent.startsWith(a.value)&&r.push(e.textContent),r.sort())}),r},u=/[a-zA-Z0-9]/;if(u.exec(d)){var s;if(e.preventDefault(),0===i.length)a.value=a.value+d,s=c(),s.length>0&&(a.value=a.value+s[0].slice(r+1,s[0].length),a.setSelectionRange(r+1,s[0].length));else{window.getSelection();a.value=a.value.slice(0,a.selectionStart)+a.value.slice(a.selectionEnd),a.value=a.value+d,s=c(),s.length>0&&(a.value=a.value+s[0].slice(r+1,s[0].length),a.setSelectionRange(r+1,s[0].length))}}}},S=function(e){var t=b(e.target,e.which);t?t.focus():e.which===m&&(e.preventDefault(),g(e))},x=function(e){},L=function(e){if("none"!==a.style.display){var n=t.getBoundingClientRect();a.style.top=n.top+document.body.scrollTop+"px",a.style.left=n.left+document.body.scrollLeft+"px",a.style.width=t.offsetWidth+"px",a.style.height=t.offsetHeight+"px"}};a.addEventListener("paste",x),a.addEventListener("input",x),a.addEventListener("blur",C),a.addEventListener("keydown",N),o.addEventListener("click",g),o.addEventListener("keypress",g),o.addEventListener("dblclick",g),o.addEventListener("keydown",S),window.addEventListener("resize",L)};new S;o(t),t.numberOfColumns()>0&&0===t.numberOfRows()&&p(),a()};